<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NelStore: Estações</title>
    <!-- Incluindo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluindo a fonte Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .product-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .star-rating {
            display: flex;
            gap: 2px;
        }
        .star {
            color: #ccc;
            cursor: pointer;
        }
        .star.filled {
            color: #ffc107;
        }
        .product-grid-container {
            transition: background-color 0.5s ease-in-out;
        }
        .modal-enter-active, .modal-leave-active {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        .modal-enter, .modal-leave-to {
            transform: scale(0.95);
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Configuração do Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Habilita logs de depuração para o Firestore.
        setLogLevel('debug');
        
        // Variáveis globais do Firebase, fornecidas pelo ambiente.
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let db, auth, userId;

        // Função de inicialização do Firebase e autenticação
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Listener para o estado de autenticação
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        // Exibir o ID do usuário no console e na interface
                        console.log("Usuário autenticado:", userId);
                        const userIdElement = document.getElementById('user-id-display');
                        if (userIdElement) {
                            userIdElement.textContent = `Seu ID de Usuário: ${userId}`;
                        }
                    } else {
                        console.log("Usuário não autenticado.");
                    }
                });
            } catch (error) {
                console.error("Erro ao inicializar o Firebase:", error);
            }
        }

        // Garante que o Firebase seja inicializado ao carregar a página
        window.addEventListener('load', initializeFirebase);
        
        // Exporta as variáveis para uso em outras partes do script
        window.firebase = {
            db,
            auth,
            userId,
            appId,
            collection,
            doc,
            getDocs,
            getDoc,
            addDoc,
            query,
            where,
            onSnapshot
        };
    </script>

    <!-- Header com nome da loja e botões de navegação -->
    <header class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center flex-wrap">
            <div class="flex flex-col items-start md:flex-row md:items-center md:space-x-4">
                <h1 class="text-3xl font-bold text-gray-900">NelStore: Estações</h1>
                <span id="user-id-display" class="text-xs text-gray-500 mt-1 md:mt-0"></span>
            </div>
            
            <!-- Botões de navegação para as estações e carrinho -->
            <div class="flex items-center space-x-4 mt-4 md:mt-0">
                <a href="#" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-300" data-tab="all">Todos</a>
                <a href="#" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-300" data-tab="verao">Verão</a>
                <a href="#" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-300" data-tab="outono">Outono</a>
                <a href="#" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-300" data-tab="inverno">Inverno</a>
                <a href="#" class="nav-link text-gray-600 hover:text-gray-900 transition-colors duration-300" data-tab="primavera">Primavera</a>
                <button id="cart-button" class="relative text-gray-600 hover:text-gray-900 transition-colors duration-300 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13L4.9 19H19" />
                    </svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
            </div>
            <!-- Campo de pesquisa -->
            <div class="w-full md:w-auto mt-4 md:mt-0">
                <input type="text" id="search-input" placeholder="Pesquisar produtos..." class="w-full md:w-64 p-2 pl-4 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </header>

    <main id="main-container" class="product-grid-container container mx-auto p-4 md:p-8">
        <!-- Título da seção, agora com ID para ser manipulado via JS -->
        <h2 id="product-section-title" class="text-4xl font-extrabold text-center my-8 text-gray-900">Coleção NelStore</h2>
        
        <!-- Contêiner de produtos -->
        <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
            <!-- Os produtos serão injetados aqui via JavaScript -->
        </div>
    </main>

    <!-- Modal de descrição do produto -->
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-3/4 lg:w-1/2 relative transform transition-all duration-300 modal-enter">
            <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div id="modal-content" class="flex flex-col md:flex-row items-center md:items-start gap-6">
                <!-- Conteúdo do modal (imagem, texto, etc.) será injetado aqui -->
            </div>
        </div>
    </div>

    <!-- Modal do carrinho de compras -->
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-3/4 lg:w-1/2 relative transform transition-all duration-300 modal-enter">
            <button id="close-cart-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-2xl font-bold mb-4">Seu Carrinho</h3>
            <div id="cart-items" class="space-y-4 max-h-96 overflow-y-auto">
                <!-- Itens do carrinho serão injetados aqui -->
            </div>
            <div id="cart-total" class="mt-6 pt-4 border-t border-gray-200 text-xl font-bold text-right">
                Total: R$ 0.00
            </div>
            <button id="checkout-button" class="mt-6 w-full py-3 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition-colors duration-300">Finalizar Compra</button>
        </div>
    </div>

    <!-- Modal de Finalização de Compra (Email) -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 relative transform transition-all duration-300 modal-enter">
            <button id="close-checkout-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-2xl font-bold mb-4 text-center">Finalizar Compra</h3>
            <p class="text-gray-700 mb-6 text-center">Insira seu e-mail para acompanhar o pedido.</p>
            <form id="checkout-form" class="space-y-4">
                <input type="email" id="email-input" placeholder="Seu e-mail" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500">
                <button type="submit" class="w-full py-3 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition-colors duration-300">
                    Confirmar Compra
                </button>
            </form>
            <div id="checkout-success-message" class="hidden mt-4 text-center text-green-600 font-semibold">
                Compra finalizada! Em breve você receberá um e-mail com os detalhes do pedido.
            </div>
        </div>
    </div>
    
    <!-- Modal de Avaliação de Produto -->
    <div id="review-modal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 relative transform transition-all duration-300 modal-enter">
            <button id="close-review-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-2xl font-bold mb-4 text-center">Avalie este Produto</h3>
            <form id="review-form" class="space-y-4">
                <div class="flex flex-col items-center">
                    <div id="review-star-rating" class="star-rating mb-2">
                        <span class="text-3xl star" data-value="1">&#9733;</span>
                        <span class="text-3xl star" data-value="2">&#9733;</span>
                        <span class="text-3xl star" data-value="3">&#9733;</span>
                        <span class="text-3xl star" data-value="4">&#9733;</span>
                        <span class="text-3xl star" data-value="5">&#9733;</span>
                    </div>
                    <input type="hidden" id="review-rating" required>
                    <input type="file" id="review-image" accept="image/*" class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <textarea id="review-comment" placeholder="Escreva seu comentário aqui..." required class="w-full p-3 h-32 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                <button type="submit" class="w-full py-3 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition-colors duration-300">
                    Enviar Avaliação
                </button>
            </form>
        </div>
    </div>

    <script>
        // Array com todos os produtos.
        // Adicione mais produtos aqui, seguindo o mesmo padrão.
        // Lembre-se de sempre inserir um novo ID único.
        const products = [
            // Produtos de Verão
            { id: 1, name: "Ar Condicionado", price: 2000.00, image: "https://a-static.mlcdn.com.br/800x560/ar-condicionado-split-12-000btus-gree-inverter-frio-gwc12atbxa-d6dna1a/magazineluiza/238774900/26981dfe68a3c11870767cb3c41b79e9.jpg", season: "verao", description: "Ar-condicionado potente e silencioso para refrescar seus dias mais quentes. Tecnologia Inverter para economia de energia." },
            { id: 2, name: "Óculos de Sol", price: 150.00, image: "https://images.tcdn.com.br/img/img_prod/754260/oculos_de_sol_masculino_mormaii_lagos_m0074a0203_polarizado_12951_1_0bba86f1ad77ac5f7c553412fd386eaf.jpg", season: "verao", description: "Óculos de sol moderno com lentes polarizadas que oferecem 100% de proteção UV. Ideal para a praia ou piscina." },
            { id: 3, name: "Cooler Térmico", price: 120.00, image: "https://a-static.mlcdn.com.br/800x560/caixa-termica-cooler-26l-com-alca-35-latas-bel/virtualgift/6579-5681/e3f319b5ef077475f6d11d051f59f035.jpeg", season: "verao", description: "Caixa térmica de 26L, perfeita para manter bebidas e alimentos gelados em passeios e acampamentos. Capacidade para 35 latas." },
            { id: 4, name: "Frigobar", price: 1500.00, image: "https://d296pbmv9m7g8v.cloudfront.net/Custom/Content/Products/10/72/1072883_frigobar-electrolux-em90b-90l-efficient-cycle-defrost-com-controle-de-temperatura-10010908_l24_638717847826791642.webp", season: "verao", description: "Frigobar compacto e eficiente, ideal para quartos, escritórios ou áreas de lazer. Mantenha suas bebidas sempre à mão." },
            { id: 5, name: "Ventilador Portátil", price: 85.00, image: "https://cdn.leroymerlin.com.br/products/mini_ventilador_usb_potente_silencioso_portatil_notebook_comp_1566809498_d58e_600x600.jpeg", season: "verao", description: "Ventilador de mesa potente, com design compacto e três velocidades. Ideal para refrescar ambientes pequenos." },
            { id: 21, name: "Cadeira de Praia", price: 110.00, image: "https://moveislinhares.vteximg.com.br/arquivos/ids/199757-1000-1000/110233-1.jpg?v=637753506794070000", season: "verao", description: "Cadeira de praia dobrável e leve, com estrutura em alumínio resistente. Conforto e praticidade para curtir o sol." },
            { id: 22, name: "Protetor Solar", price: 65.00, image: "https://ikesaki.vtexassets.com/arquivos/ids/246154-800-auto?v=637255132536870000&width=800&height=auto&aspect=true", season: "verao", description: "Protetor solar facial com cor e FPS 70. Protege a pele dos raios UV e uniformiza o tom." },
            { id: 23, name: "Guarda Sol", price: 95.00, image: "https://static.lojasaquasol.com.br/public/aquasol/imagens/produtos/guarda-sol-tipo-italiano-ombrelone-redondo-linha-classica-em-madeira-solaris-6334ac316c911.png", season: "verao", description: "Guarda sol resistente e perfeito para cobrir toda familia." },
            { id: 24, name: "Prancha de Stand-Up Paddle", price: 1800.00, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrNw6Wweo924hMGszY6n6BmL9SRtJSclyrtA&s", season: "verao", description: "Prancha inflável de SUP, fácil de transportar e ideal para remadas tranquilas em lagos ou no mar." },
            { id: 25, name: "Kit de Snorkel", price: 145.00, image: "https://a-static.mlcdn.com.br/800x560/kit-mergulho-snorkel-pe-de-pato-mascara-natacao-verao-ferias-kapnoh/krvariedades/mergulhovar-2/c5c88dbbedbc8120361a0f695b21cd6e.jpeg", season: "verao", description: "Kit completo para snorkel, com máscara de silicone e nadadeiras ajustáveis. Explore a vida marinha com conforto." },

            // Produtos de Outono
            { id: 6, name: "Cachecol", price: 30.00, image: "https://torratorra.vtexassets.com/arquivos/ids/2314661/66245000003093M.jpg?v=638754246097370000", season: "outono", description: "Cachecol de lã macia, perfeito para os dias mais amenos de outono. Conforto e estilo em uma só peça." },
            { id: 7, name: "Blusão de Moletom", price: 180.00, image: "https://cdn.awsli.com.br/2684/2684797/produto/248197434/blusao-blusa_moleton-azul_baixa_temperatura_frio-bxpqi4p5ll.jpg", season: "outono", description: "Blusão de moletom com capuz e bolso, ideal para o clima de transição do outono. Mantenha-se aquecido com estilo." },
            { id: 8, name: "Chá de Camomila", price: 15.00, image: "https://fly.metroimg.com/upload/q_85,w_700/https://uploads.metroimg.com/wp-content/uploads/2023/03/10111334/GettyImages-1336729545.jpg", season: "outono", description: "Chá de camomila em sachês, com aroma suave e relaxante. Perfeito para uma tarde fria de outono." },
            { id: 9, name: "Jaqueta Corta Vento", price: 250.00, image: "https://cdn.sistemawbuy.com.br/arquivos/f0853c897b6ec0b9ff1e212e78ca35d6/produtos/664df06b12e19/jaqueta-corta-vento-preta-basica-4mud-casual-1-frente-664df06b856ca.jpg", season: "outono", description: "Jaqueta leve e resistente à chuva e vento, ideal para proteger em dias imprevisíveis. Design moderno e prático." },
            { id: 10, name: "Bota de Couro", price: 350.00, image: "https://img.irroba.com.br/fit-in/600x600/filters:fill(fff):quality(80)/capellib/catalog/8204-pinhao-5.jpeg", season: "outono", description: "Bota de couro durável e elegante. Perfeita para caminhar em trilhas ou para um look casual de outono." },
            { id: 26, name: "Vela Aromática", price: 40.00, image: "https://cdn.sistemawbuy.com.br/arquivos/eed86037062709a8591656f66bfbbb5c/produtos/673140d1e82b2/img_4070-photoroom-678d223a46aa4.jpg", season: "outono", description: "Vela aromática com essências de lavanda e alecrim. Crie um ambiente aconchegante e relaxante para o outono." },
            { id: 27, name: "Livro de Romance", price: 55.00, image: "https://fastprint.com.br/wp-content/uploads/2023/06/Detalhe-prod-livro-capadura-full2x-1010x718-1.jpg.webp", season: "outono", description: "Clássico da literatura perfeito para ser lido em um dia chuvoso de outono. Histórias que aquecem o coração." },
            { id: 28, name: "Lenço de Seda", price: 70.00, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR4okUkHpbt2vBNjY7G80VHLeIAQU3KZ4_KcA&s", season: "outono", description: "Lenço de seda com estampa floral, um acessório versátil para complementar o visual de outono. Protege e embeleza." },
            { id: 29, name: "Manta para Sofá", price: 160.00, image: "https://tecibomdecor.cdn.magazord.com.br/img/2023/04/produto/3152/manta-para-sofa-karsten-denver-tecibom-decor-3.jpg?ims=800x800", season: "outono", description: "Manta de tricot macia e elegante para decorar seu sofá. Ideal para se enrolar em uma noite fria." },
            { id: 30, name: "Chaleira Elétrica", price: 130.00, image: "https://casafreitas2.vteximg.com.br/arquivos/ids/267902-1000-1000/20230911190707-0.jpg?v=638811159556030000", season: "outono", description: "Chaleira elétrica de inox com capacidade de 1.8L. Ferva água rapidamente para chás e cafés." },

            // Produtos de Inverno
            { id: 11, name: "Casaco de Lã", price: 500.00, image: "https://oqvestir.fbitsstatic.net/img/p/casaco-feminino-la-batida-alongado-bege-170060/426717.jpg?w=1600&h=2133&v=202501231556", season: "inverno", description: "Casaco de lã forrado, perfeito para as temperaturas mais baixas do inverno. Muito quente e confortável." },
            { id: 12, name: "Chocolates Quentes", price: 45.00, image: "https://www.oitedi.com.br/_next/image?url=https%3A%2F%2Ftedi-production.s3.amazonaws.com%2Fcooking_recipes%2Ffood_description%2Fd6c212632b374c97dcb6b48f48bca6ddbdad7501.png&w=1080&q=70", season: "inverno", description: "Seleção de chocolates em barra e em pó para preparar um delicioso chocolate quente cremoso. Aqueça-se com muito sabor." },
            { id: 13, name: "Aquecedor Elétrico", price: 220.00, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTo738PZH-VG4t7a3gttshAQ7S2Sgku09SfIQ&s", season: "inverno", description: "Aquecedor elétrico compacto e potente, aquece rapidamente o ambiente. Possui termostato ajustável para o máximo de conforto." },
            { id: 14, name: "Luvas de Couro", price: 75.00, image: "https://fieroshop.vtexassets.com/arquivos/ids/182670/luva-feminina-caramelo-de-couro.jpg?v=638781581787200000", season: "inverno", description: "Luvas de couro genuíno, elegantes e resistentes. Protegem suas mãos do frio com muito estilo." },
            { id: 15, name: "Edredom de Plumas", price: 480.00, image: "https://mundodoenxoval.vtexassets.com/arquivos/ids/206379/01070079_1501_3-EDREDOM-PLUMA-DE-GANSO-C.png?v=637895268294770000", season: "inverno", description: "Edredom de plumas de ganso, muito macio e quente. Garante noites de sono confortáveis e aconchegantes." },
            { id: 31, name: "Gorros e Toucas", price: 60.00, image: "https://images.tcdn.com.br/img/img_prod/680926/kit_gorros_dr7_street_3_pecas_preto_cinza_laranja_14663_1_aed7ed26ed8432cfab27ba5de34d48db.jpg", season: "inverno", description: "Kit de gorros de lã, super quentes e estilosos. Proteção e conforto para a cabeça e orelhas em dias frios." },
            { id: 32, name: "Meias Térmicas", price: 35.00, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ-azwXgX0i9xiE01M4hAThbJ6DaEd9ZA0lIQ&s", season: "inverno", description: "Meias térmicas de alta qualidade, mantêm os pés aquecidos e secos. Ideal para usar com botas de inverno." },
            { id: 33, name: "Pijama de Soft", price: 150.00, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTM8PhPm2ZlA8S7zfJl8weYtUGXsw0tOkHEZA&s", season: "inverno", description: "Pijama de soft super macio e quente, com botões para facilitar o uso. Garante noites aconchegantes." },
            { id: 34, name: "Lareira Portátil", price: 890.00, image: "https://cdn.awsli.com.br/600x1000/284/284640/produto/8518434/aa8bfff120.jpg", season: "inverno", description: "Lareira ecológica e portátil, aquece o ambiente com fogo real e sem fumaça. Ideal para criar um clima de inverno." },
            { id: 35, name: "Churrasqueira Portátil", price: 320.00, image: "https://d296pbmv9m7g8v.cloudfront.net/Custom/Content/Products/98/85/988560_churrasqueira-portatil-mor-araguaia-3007-10001250_l112_638786119443597430.webp", season: "inverno", description: "Churrasqueira a carvão compacta, com tampa e alça de transporte. Perfeita para um churrasco de inverno em família." },

            // Produtos de Primavera
            { id: 16, name: "Vaso de Flores", price: 60.00, image: "https://img.joomcdn.net/6775483d9b2de72df2c100b3bef857d5ef85d315_original.jpeg", season: "primavera", description: "Vaso de cerâmica decorativo, perfeito para acomodar flores frescas e dar vida à sua casa. Acompanha flores artificiais." },
            { id: 17, name: "Regador", price: 50.00, image: "https://images.tcdn.com.br/img/img_prod/1048182/regador_de_5_lts_91_1_ad679d84ce095c4e9ed46aa5ef6bfe73.jpg", season: "primavera", description: "Regador de plástico de 10L, leve e prático. Essencial para cuidar do seu jardim e plantas em vasos." },
            { id: 18, name: "Chapéu de Sol", price: 90.00, image: "https://www.mariachapeu.com.br/media/wysiwyg/chapeu_palha_surf.JPG", season: "primavera", description: "Chapéu de praia com proteção UV, ideal para os dias de sol e passeios ao ar livre. Design moderno e charmoso." },
            { id: 19, name: "Sementes de Flores", price: 25.00, image: "https://images.tcdn.com.br/img/img_prod/350075/kit_sementes_de_flores_para_plantar_na_primavera_com_6_variedades_isla_17763_1_c302cb2e10d92ab249929fcd509f4f3b.png", season: "primavera", description: "Kit com 10 envelopes de sementes de flores variadas. Cultive um jardim colorido e perfumado na primavera." },
            { id: 20, name: "Guarda-chuva", price: 80.00, image: "https://elastobor.vtexassets.com/arquivos/ids/314660/GUARDA-CHUVA-PORTARIA-ELASTOBOR-MANUAL-140-PRETO.jpg?v=638768816546600000", season: "primavera", description: "Guarda-chuva automático e reforçado, ideal para as chuvas de primavera. Design compacto e fácil de transportar." },
            { id: 36, name: "Cesto de Piquenique", price: 180.00, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSJaGUEszdubTqUTyAnCs8gbJwScnkj1Ir74A&s", season: "primavera", description: "Cesto de piquenique tradicional com forro de tecido xadrez. Perfeito para uma tarde agradável em um parque." },
            { id: 37, name: "Kit de Jardinagem", price: 105.00, image: "https://a-static.mlcdn.com.br/800x560/kit-jardinagem-tramontina-78124805-13-pecas/magazineluiza/238837700/40cda26f6444b52d3a85dfc114501975.jpg", season: "primavera", description: "Kit de ferramentas básicas para jardinagem, com pá, ancinho e garfo. Essencial para cuidar de suas plantas." },
            { id: 38, name: "Saco de Dormir", price: 240.00, image: "https://diafer.vtexassets.com/arquivos/ids/161808-800-auto?v=636525800485770000&width=800&height=auto&aspect=true", season: "primavera", description: "Saco de dormir leve e compacto, ideal para acampamentos na primavera. Mantenha-se confortável em noites mais frescas." },
            { id: 39, name: "Binóculos", price: 300.00, image: "https://images.tcdn.com.br/img/img_prod/1150100/binoculo_sumax_12_45x60_bs_ventura_profissional_345_1_cf7b674b5256c5eae5cc2e252cc0974c.jpg", season: "primavera", description: "Binóculos de alta definição, perfeitos para a observação de aves e paisagens durante a primavera." },
            { id: 40, name: "Rede de Descanso", price: 150.00, image: "https://images.tcdn.com.br/img/img_prod/1354873/rede_de_descanso_individual_extra_azur_157_1_15420e71b4bc5f17c9ea4abf1b44bdd0.png", season: "primavera", description: "Rede de descanso de algodão macio. Perfeita para relaxar no jardim em um dia ensolarado de primavera." },
        ];

        let cart = []; // Array para armazenar os itens do carrinho
        let currentProductForReview = null;

        // Elementos do DOM
        const mainContainer = document.getElementById('main-container');
        const productList = document.getElementById('product-list');
        const searchInput = document.getElementById('search-input');
        const navLinks = document.querySelectorAll('.nav-link');
        const productModal = document.getElementById('product-modal');
        const closeModalButton = document.getElementById('close-modal');
        const cartButton = document.getElementById('cart-button');
        const cartModal = document.getElementById('cart-modal');
        const closeCartModalButton = document.getElementById('close-cart-modal');
        const checkoutModal = document.getElementById('checkout-modal');
        const closeCheckoutModalButton = document.getElementById('close-checkout-modal');
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotalSpan = document.getElementById('cart-total');
        const cartCountSpan = document.getElementById('cart-count');
        const checkoutButton = document.getElementById('checkout-button');
        const checkoutForm = document.getElementById('checkout-form');
        const checkoutSuccessMessage = document.getElementById('checkout-success-message');
        const reviewModal = document.getElementById('review-modal');
        const closeReviewModalButton = document.getElementById('close-review-modal');
        const reviewForm = document.getElementById('review-form');
        const reviewStarRating = document.getElementById('review-star-rating');
        const reviewRatingInput = document.getElementById('review-rating');
        const productSectionTitle = document.getElementById('product-section-title');

        // Mapa de títulos para cada estação
        const seasonTitles = {
            all: 'Coleção NelStore',
            verao: 'Produtos de Verão',
            outono: 'Produtos de Outono',
            inverno: 'Produtos de Inverno',
            primavera: 'Produtos de Primavera'
        };

        // Função para mudar a cor de fundo do container principal
        function changeMainBackground(season) {
            const colors = {
                all: 'bg-gray-100',
                verao: 'bg-yellow-100',
                outono: 'bg-orange-100',
                inverno: 'bg-blue-100',
                primavera: 'bg-green-100'
            };
            mainContainer.className = `product-grid-container container mx-auto p-4 md:p-8 ${colors[season]}`;
        }

        // Função para renderizar as estrelas de avaliação
        function renderStars(rating) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += `<span class="text-xl star ${i <= rating ? 'filled' : ''}">&#9733;</span>`;
            }
            return starsHtml;
        }

        // Função para renderizar os produtos na tela
        function renderProducts(filteredProducts) {
            productList.innerHTML = '';
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = `product-card bg-white rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 animate-fade-in`;
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover object-center">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-gray-900">${product.name}</h3>
                        <p class="text-lg text-gray-600 mt-2">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                        <button class="add-to-cart-btn mt-4 w-full py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition-colors duration-300">
                            Adicionar ao Carrinho
                        </button>
                    </div>
                `;
                // Adiciona o evento de clique para abrir o modal do produto
                productCard.querySelector('img').addEventListener('click', () => showProductModal(product));
                productCard.querySelector('.add-to-cart-btn').addEventListener('click', (event) => {
                    event.stopPropagation(); // Evita que o clique no botão ative o modal
                    addToCart(product);
                });
                productList.appendChild(productCard);
            });
        }

        // Função para mostrar o modal do produto com descrição e avaliações
        async function showProductModal(product) {
            currentProductForReview = product;
            const modalContent = document.getElementById('modal-content');
            
            // Carrega as avaliações do Firestore
            const reviews = await fetchReviews(product.id);
            const reviewsHtml = reviews.length > 0 ? reviews.map(review => `
                <div class="bg-gray-100 p-4 rounded-lg">
                    <div class="flex items-center mb-2">
                        <span class="font-bold mr-2">${review.userId.substring(0, 8)}...</span>
                        <div class="star-rating">${renderStars(review.rating)}</div>
                    </div>
                    <p class="text-gray-700">${review.comment}</p>
                    ${review.imageUrl ? `<img src="${review.imageUrl}" class="mt-2 rounded-lg max-h-40 object-cover w-full">` : ''}
                </div>
            `).join('') : '<p class="text-gray-500 italic">Nenhuma avaliação ainda. Seja o primeiro a avaliar!</p>';

            modalContent.innerHTML = `
                <div class="w-full md:w-1/2">
                    <img src="${product.image}" alt="${product.name}" class="w-full rounded-lg object-cover shadow-md">
                </div>
                <div class="flex flex-col gap-4 w-full md:w-1/2">
                    <h2 class="text-3xl font-bold">${product.name}</h2>
                    <p class="text-xl text-gray-600">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                    <p class="text-gray-700">${product.description}</p>
                    <div class="flex flex-col gap-2">
                        <button class="add-to-cart-btn mt-4 w-full py-3 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition-colors duration-300">
                            Adicionar ao Carrinho
                        </button>
                        <button id="review-product-btn" class="w-full py-3 bg-yellow-500 text-white font-bold rounded-full hover:bg-yellow-600 transition-colors duration-300">
                            Avaliar Produto
                        </button>
                    </div>
                    <div class="mt-4">
                        <h4 class="text-xl font-bold mb-2">Avaliações dos Clientes</h4>
                        <div class="space-y-4 max-h-48 overflow-y-auto">
                            ${reviewsHtml}
                        </div>
                    </div>
                </div>
            `;
            
            modalContent.querySelector('.add-to-cart-btn').addEventListener('click', () => {
                addToCart(product);
                productModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            });
            
            modalContent.querySelector('#review-product-btn').addEventListener('click', () => {
                productModal.classList.add('hidden');
                showReviewModal(product.id);
            });

            productModal.classList.remove('hidden');
            productModal.querySelector('div').classList.remove('modal-enter');
            productModal.querySelector('div').classList.add('modal-enter-active');
            document.body.classList.add('overflow-hidden');
        }

        // Função para mostrar o modal de avaliação
        function showReviewModal(productId) {
            reviewModal.classList.remove('hidden');
            reviewModal.querySelector('div').classList.remove('modal-enter');
            reviewModal.querySelector('div').classList.add('modal-enter-active');
            document.body.classList.add('overflow-hidden');
            reviewForm.dataset.productId = productId;
        }

        // Adiciona evento de clique para fechar o modal do produto
        closeModalButton.addEventListener('click', () => {
            productModal.querySelector('div').classList.remove('modal-enter-active');
            productModal.querySelector('div').classList.add('modal-enter');
            setTimeout(() => {
                productModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        });

        // Adiciona evento de clique para fechar o modal do carrinho
        closeCartModalButton.addEventListener('click', () => {
            cartModal.querySelector('div').classList.remove('modal-enter-active');
            cartModal.querySelector('div').classList.add('modal-enter');
            setTimeout(() => {
                cartModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        });

        // Adiciona evento de clique para fechar o modal de checkout
        closeCheckoutModalButton.addEventListener('click', () => {
            checkoutModal.querySelector('div').classList.remove('modal-enter-active');
            checkoutModal.querySelector('div').classList.add('modal-enter');
            setTimeout(() => {
                checkoutModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
                checkoutSuccessMessage.classList.add('hidden');
                checkoutForm.reset();
            }, 300);
        });
        
        // Adiciona evento de clique para fechar o modal de avaliação
        closeReviewModalButton.addEventListener('click', () => {
            reviewModal.querySelector('div').classList.remove('modal-enter-active');
            reviewModal.querySelector('div').classList.add('modal-enter');
            setTimeout(() => {
                reviewModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
                reviewForm.reset();
            }, 300);
        });

        // Adicionar ao carrinho
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCart();
        }

        // Atualizar o carrinho e a contagem
        function updateCart() {
            cartItemsContainer.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price * item.quantity;
                const cartItem = document.createElement('div');
                cartItem.className = 'flex items-center justify-between p-2 bg-gray-100 rounded-lg';
                cartItem.innerHTML = `
                    <div class="flex items-center gap-4">
                        <img src="${item.image}" alt="${item.name}" class="h-16 w-16 object-cover rounded-lg">
                        <div>
                            <p class="font-semibold">${item.name}</p>
                            <p class="text-sm text-gray-600">R$ ${item.price.toFixed(2).replace('.', ',')} x ${item.quantity}</p>
                        </div>
                    </div>
                    <button class="remove-from-cart-btn text-red-500 hover:text-red-700 transition-colors duration-300" data-id="${item.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                cartItemsContainer.appendChild(cartItem);
            });
            cartTotalSpan.textContent = `Total: R$ ${total.toFixed(2).replace('.', ',')}`;
            cartCountSpan.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

            // Adiciona evento para remover item do carrinho
            document.querySelectorAll('.remove-from-cart-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const idToRemove = parseInt(event.currentTarget.dataset.id);
                    cart = cart.filter(item => item.id !== idToRemove);
                    updateCart();
                });
            });
        }

        // Abrir modal do carrinho
        cartButton.addEventListener('click', () => {
            updateCart();
            cartModal.classList.remove('hidden');
            cartModal.querySelector('div').classList.remove('modal-enter');
            cartModal.querySelector('div').classList.add('modal-enter-active');
            document.body.classList.add('overflow-hidden');
        });
        
        // Adiciona evento para abrir o modal de checkout
        checkoutButton.addEventListener('click', () => {
            cartModal.classList.add('hidden');
            checkoutModal.classList.remove('hidden');
            checkoutModal.querySelector('div').classList.remove('modal-enter');
            checkoutModal.querySelector('div').classList.add('modal-enter-active');
            document.body.classList.add('overflow-hidden');
        });
        
        // Adiciona evento para o formulário de checkout
        checkoutForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const email = document.getElementById('email-input').value;
            console.log(`Email de checkout recebido: ${email}`);
            
            // Simula o processamento da compra
            checkoutForm.classList.add('hidden');
            checkoutSuccessMessage.classList.remove('hidden');
        });

        // Evento de pesquisa
        searchInput.addEventListener('input', (event) => {
            const searchTerm = event.target.value.toLowerCase();
            const filteredProducts = products.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                product.season.toLowerCase().includes(searchTerm)
            );
            renderProducts(filteredProducts);
        });

        // Evento de filtragem por aba
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const filter = event.target.dataset.tab;
                let filteredProducts;
                if (filter === 'all') {
                    filteredProducts = products;
                } else {
                    filteredProducts = products.filter(product => product.season === filter);
                }
                renderProducts(filteredProducts);
                changeMainBackground(filter);
                // Atualiza o texto do título da seção
                productSectionTitle.textContent = seasonTitles[filter];
                // Animação de rolagem para o topo da lista de produtos
                productList.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Evento de avaliação de estrelas no modal
        reviewStarRating.addEventListener('click', (event) => {
            const clickedStar = event.target.closest('.star');
            if (clickedStar) {
                const rating = parseInt(clickedStar.dataset.value);
                reviewRatingInput.value = rating;
                document.querySelectorAll('.star').forEach(star => {
                    if (parseInt(star.dataset.value) <= rating) {
                        star.classList.add('filled');
                    } else {
                        star.classList.remove('filled');
                    }
                });
            }
        });
        
        // Evento de submissão do formulário de avaliação
        reviewForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const { db, appId, userId, addDoc, collection } = window.firebase;
            if (!db || !userId) {
                console.error("Firebase não inicializado ou usuário não autenticado.");
                return;
            }
            
            const productId = parseInt(event.target.dataset.productId);
            const rating = parseInt(reviewRatingInput.value);
            const comment = document.getElementById('review-comment').value;
            // Por questões de segurança, não estamos implementando upload de imagem para o armazenamento do Firebase neste momento.
            // Para adicionar imagens, você precisaria de um sistema de upload e storage.
            const reviewData = {
                productId: productId,
                userId: userId,
                rating: rating,
                comment: comment,
                createdAt: new Date()
            };

            try {
                const reviewRef = collection(db, `artifacts/${appId}/public/data/reviews`);
                await addDoc(reviewRef, reviewData);
                console.log("Avaliação enviada com sucesso!");
                closeReviewModalButton.click(); // Fecha o modal
            } catch (error) {
                console.error("Erro ao enviar avaliação:", error);
            }
        });
        
        // Função para buscar avaliações no Firestore
        async function fetchReviews(productId) {
            const { db, appId, getDocs, collection, query, where } = window.firebase;
            if (!db) return [];

            try {
                const q = query(collection(db, `artifacts/${appId}/public/data/reviews`), where("productId", "==", productId));
                const querySnapshot = await getDocs(q);
                const reviews = [];
                querySnapshot.forEach((doc) => {
                    reviews.push(doc.data());
                });
                return reviews;
            } catch (error) {
                console.error("Erro ao buscar avaliações:", error);
                return [];
            }
        }

        // Renderizar todos os produtos ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts(products);
        });

    </script>
</body>
</html>
